<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:security="http://www.springframework.org/schema/security"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
                           http://www.springframework.org/schema/beans/spring-beans.xsd
                           http://www.springframework.org/schema/security
                           http://www.springframework.org/schema/security/spring-security-3.2.xsd">

 <!--
	<security:http auto-config="true">
		<security:intercept-url pattern="/rest/**" access="ROLE_USER"/>
		<security:intercept-url pattern="/documentation" ref="digestFilter" access="ROLE_USER"/>
	</security:http>
 
 
	<security:authentication-manager>
	  <security:authentication-provider ref="customAuthenticationProvider"/>
	</security:authentication-manager>
	
	<bean id="digestFilter"
      class="org.springframework.security.web.authentication.www.DigestAuthenticationFilter">
        <property name="userDetailsService" ref="userService" />
        <property name="authenticationEntryPoint" ref="digestEntryPoint" />
    </bean>
    <bean id="digestEntryPoint" 
      class="org.springframework.security.web.authentication.www.DigestAuthenticationEntryPoint">
        <property name="realmName" value="Contacts Realm via Digest Authentication" />
        <property name="key" value="acegi" />
    </bean>
    
-->


<security:authentication-manager alias="baseAuthenticationManager">
	<security:authentication-provider user-service-ref="customUserDetailsService"/>
</security:authentication-manager>

<!--
<security:authentication-manager id="digestAuthenticationManager">    
	<security:authentication-provider user-service-ref="digestUserDetailsService"/>
</security:authentication-manager>
-->

<!--
<bean id="digestAuthenticationManager" class="org.springframework.security.authentication.ProviderManager">
    <constructor-arg>
        <list>
            <bean class="org.tstraszewski.service.auth.DigestUserDetailsService"/>
        </list>
    </constructor-arg>
</bean>
-->
<!-->
	<security:http  auto-config="true" pattern="/rest/flyHistory/**" use-expressions="false" entry-point-ref="digestEntryPoint" authentication-manager-ref="digestAuthenticationManager">
    	<security:intercept-url pattern="/rest/flyHistory/**" access="ROLE_ADMIN"/>
        <security:custom-filter ref="digestFilter" after="BASIC_AUTH_FILTER"/>
        
        
        <security:session-management>
        	<security:concurrency-control max-sessions="1" error-if-maximum-exceeded="true" />
    	</security:session-management>
        
    </security:http>
-->

	<security:http auto-config="true" pattern="/**" use-expressions="false" authentication-manager-ref="baseAuthenticationManager">
		<security:intercept-url pattern="/rest/users/**" access="ROLE_ADMIN"/>

		<security:form-login login-page="/login.html" default-target-url="/index.html" authentication-failure-url="/failure.html"/>
        <security:logout logout-url="/logout" logout-success-url="/login.html"/>
        <security:access-denied-handler error-page="/failure.html"/>
        <security:anonymous enabled="false"/>
        
        <security:session-management>
        	<!--<security:concurrency-control max-sessions="1" />-->
        	<security:concurrency-control max-sessions="1" error-if-maximum-exceeded="true" />
    	</security:session-management>
        
    </security:http>


    
    <!--
    <bean id="digestFilter"
      class="org.springframework.security.web.authentication.www.DigestAuthenticationFilter">
        <property name="userDetailsService" ref="digestUserDetailsService" />
        <property name="authenticationEntryPoint" ref="digestEntryPoint" />
    </bean>
    <bean id="digestEntryPoint" 
      class="org.springframework.security.web.authentication.www.DigestAuthenticationEntryPoint">
        <property name="realmName" value="Contacts Realm via Digest Authentication" />
        <property name="key" value="acegi" />
    </bean>
   -->
    

</beans>

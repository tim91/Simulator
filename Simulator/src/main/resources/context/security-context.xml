<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:security="http://www.springframework.org/schema/security"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
                           http://www.springframework.org/schema/beans/spring-beans.xsd
                           http://www.springframework.org/schema/security
                           http://www.springframework.org/schema/security/spring-security-3.2.xsd">

 <!--
	<security:http auto-config="true">
		<security:intercept-url pattern="/rest/**" access="ROLE_USER"/>
		<security:intercept-url pattern="/documentation" ref="digestFilter" access="ROLE_USER"/>
	</security:http>
 
 
	<security:authentication-manager>
	  <security:authentication-provider ref="customAuthenticationProvider"/>
	</security:authentication-manager>
	
	<bean id="digestFilter"
      class="org.springframework.security.web.authentication.www.DigestAuthenticationFilter">
        <property name="userDetailsService" ref="userService" />
        <property name="authenticationEntryPoint" ref="digestEntryPoint" />
    </bean>
    <bean id="digestEntryPoint" 
      class="org.springframework.security.web.authentication.www.DigestAuthenticationEntryPoint">
        <property name="realmName" value="Contacts Realm via Digest Authentication" />
        <property name="key" value="acegi" />
    </bean>
    
-->

<security:authentication-manager alias="baseAuthenticationManager">
	<security:authentication-provider user-service-ref="customUserDetailsService"/>
</security:authentication-manager>

	
    	
	<security:http  auto-config="false" use-expressions="true">
		<security:intercept-url pattern="/login.html" access="permitAll()"/>
		<security:intercept-url pattern="/failure.html" access="permitAll()"/>
		<security:intercept-url pattern="/css/**" access="permitAll()"/>
		<security:intercept-url pattern="/javascript/**" access="permitAll()"/>
    	<security:intercept-url pattern="/**" access="isAuthenticated()"/>
        
		<security:form-login login-page="/login.html" default-target-url="/index.htm" authentication-failure-url="/failure.html"/>
        <security:logout invalidate-session="true" logout-url="/logout" logout-success-url="/login.html" delete-cookies="JSESSIONID"/>
        <security:access-denied-handler error-page="/failure.html"/>
        
        <security:session-management>
        	<security:concurrency-control max-sessions="1"/>
 		</security:session-management>
        
    </security:http>

<!-->
<bean id="sas" class=
 "org.springframework.security.web.authentication.session.ConcurrentSessionControlStrategy">
  <constructor-arg name="sessionRegistry" ref="sessionRegistry" />
  <property name="maximumSessions" value="1" />
</bean>

<bean id="myAuthFilter" class=
   "org.springframework.security.web.authentication.UsernamePasswordAuthenticationFilter">
  <property name="sessionAuthenticationStrategy" ref="sas" />
  <property name="authenticationManager" ref="baseAuthenticationManager" />
</bean>
<bean id="concurrencyFilter" class="org.springframework.security.web.session.ConcurrentSessionFilter">
   <property name="sessionRegistry" ref="sessionRegistry" />
   <property name="expiredUrl" value="/failure.html" />
</bean>
-->
<!-->
<bean id="sessionRegistry" class="org.springframework.security.core.session.SessionRegistryImpl" />

	<security:http pattern="/**" use-expressions="false" authentication-manager-ref="baseAuthenticationManager">
		<security:intercept-url pattern="/rest/users/**" access="ROLE_ANONYMOUS/>

		<security:intercept-url pattern="/index.html" access="isFullyAuthenticated()"/>
		<security:form-login login-page="/login.html" default-target-url="/index.html" authentication-failure-url="/failure.html"/>
        <security:logout invalidate-session="true" logout-url="/logout" logout-success-url="/login.html" delete-cookies="JSESSIONID"/>
        <security:access-denied-handler error-page="/failure.html"/>
        <security:anonymous enabled="false"/>

    	
    	 <security:custom-filter position="CONCURRENT_SESSION_FILTER" ref="concurrencyFilter" />
		  <security:session-management session-authentication-strategy-ref="sas"/>
        
    </security:http>
-->

    
    <!--
    <bean id="digestFilter"
      class="org.springframework.security.web.authentication.www.DigestAuthenticationFilter">
        <property name="userDetailsService" ref="digestUserDetailsService" />
        <property name="authenticationEntryPoint" ref="digestEntryPoint" />
    </bean>
    <bean id="digestEntryPoint" 
      class="org.springframework.security.web.authentication.www.DigestAuthenticationEntryPoint">
        <property name="realmName" value="Contacts Realm via Digest Authentication" />
        <property name="key" value="acegi" />
    </bean>
   -->
    

</beans>
